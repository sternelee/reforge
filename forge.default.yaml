# yaml-language-server: $schema=./forge.schema.json
variables:
  operating_agent: Forge
  # Define model anchors with simpler, purpose-based names
  advanced_model: &advanced_model anthropic/claude-sonnet-4

max_requests_per_turn: 100
max_tool_failure_per_turn: 3
top_p: 0.8
top_k: 30
max_tokens: 20480
max_walker_depth: 1

# Global compact configuration applied to all agents
compact:
  max_tokens: 2000
  token_threshold: 100000
  model: *advanced_model
  retention_window: 6
  message_threshold: 200
  eviction_window: 0.2
  prompt: "{{> forge-system-prompt-context-summarizer.md }}"
  on_turn_end: false

updates:
  frequency: "daily"
  auto_update: false

agents:
  - id: forge
    title: "Implementation focussed"
    description: |-
      Hands-on implementation agent that executes software development tasks through a structured 4-phase approach: task analysis, solution strategy, implementation, and quality assurance. Makes actual changes to codebases, runs shell commands, creates/modifies files, installs dependencies, and performs concrete development work. Use for building features, fixing bugs, refactoring code, or any task requiring actual modifications. Do not use for analysis-only tasks or when you want to explore options without making changes. Always validates changes through compilation and testing.
    model: *advanced_model
    system_prompt: |-
      {{> forge-system-prompt-engineer-act.md }}
    user_prompt: |-
      {{#if (eq event.name 'forge/user_task_update')}}
      <feedback>{{event.value}}</feedback>
      {{else}}
      <task>{{event.value}}</task>
      {{/if}}
      <system_date>{{current_time}}</system_date>
    reasoning:
      enabled: true
    tools:
      - forge_tool_fs_read
      - forge_tool_fs_create
      - forge_tool_fs_remove
      - forge_tool_fs_patch
      - forge_tool_process_shell
      - forge_tool_net_fetch
      - forge_tool_fs_search
      - forge_tool_fs_undo
      - sage

  - id: muse
    title: "Analysis and planning focussed"
    description: |-
      Strategic planning agent that analyzes codebases and creates comprehensive implementation plans without making any actual changes. Examines project structure, identifies risks, creates detailed Markdown documentation in the plans/ directory with objectives, implementation steps, and verification criteria. Use for project analysis, architectural guidance, risk assessment, or pre-implementation planning. Do not use when you need actual code changes or immediate implementation. Provides advisory recommendations and strategic roadmaps only.
    model: *advanced_model
    system_prompt: |-
      {{> forge-system-prompt-engineer-plan.md }}
    user_prompt: |-
      {{#if (eq event.name 'muse/user_task_update')}}
      <feedback>{{event.value}}</feedback>
      {{else}}
      <task>{{event.value}}</task>
      {{/if}}
      <system_time>{{current_time}}</system_time>
    tools:
      - forge_tool_fs_read
      - forge_tool_net_fetch
      - forge_tool_fs_search
      - forge_tool_plan_create
      - sage
  - id: prime
    title: Documentation and blog review agent
    description: |-
      Documentation and blog review agent that analyzes and reviews documentation, blog posts, and other written content. Provides feedback on clarity, structure, and technical accuracy. Use for improving documentation quality, ensuring technical correctness, and enhancing user understanding.
    model: *advanced_model
    system_prompt: |-
      {{> forge-system-prompt-prime-review.md }}
    tools:
      - forge_tool_fs_read
      - forge_tool_net_fetch
      - forge_tool_fs_search
      - forge_tool_fs_create
      - forge_tool_fs_patch
  - id: parker
    title: Expert technical writer crafting engaging content.
    description: |-
      Code review agent that analyzes code changes, provides feedback on quality, style, and best practices. Use for ensuring code quality, identifying potential issues, and improving maintainability.
    model: *advanced_model
    system_prompt: |-
      {{> forge-system-prompt-parker-code-review.md }}
    tools:
      - forge_tool_fs_read
      - forge_tool_net_fetch
      - forge_tool_fs_search
      - forge_tool_fs_create
      - forge_tool_fs_patch
  - id: sage
    title: "Codebase research and exploration focussed"
    description: |-
      Research-only tool for systematic codebase exploration and analysis. Performs comprehensive, read-only investigation: maps project architecture and module relationships, traces data/logic flow across files, analyzes API usage patterns, examines test coverage and build configurations, identifies design patterns and technical debt. Accepts detailed research questions or investigation tasks as input parameters. Use when you need to understand how systems work, why architectural decisions were made, or to investigate bugs, dependencies, complex behavior patterns, or code quality issues. Do NOT use for code modifications, running commands, or file operationsâ€”choose implementation or planning agents instead. Returns structured reports with research summaries, key findings, technical details, contextual insights, and actionable follow-up suggestions. Strictly read-only with no side effects or system modifications.
    model: *advanced_model
    system_prompt: |-
      {{> forge-system-prompt-sage-research.md }}
    user_prompt: |-
      {{#if (eq event.name 'sage/user_task_update')}}
      <feedback>{{event.value}}</feedback>
      {{else}}
      <research_question>{{event.value}}</research_question>
      {{/if}}
      <system_date>{{current_time}}</system_date>
    reasoning:
      enabled: true
    tools:
      - forge_tool_fs_read
      - forge_tool_net_fetch
      - forge_tool_fs_search
